<link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
<link rel="stylesheet" href="order-process.css">

<section class="order-process" id="order-process">
    <div class="order-line__point active-bullet current-bullet" data-index="0">
        <div class="order-line__point--label">Zaloguj się / Załóż konto</div>
        <svg class="order-line__point__bullet">
            <circle class="order-line__point__bullet--circle"></circle>
        </svg>
        <img class="order-line__point--image" src="white-check-mark-md.png">

        <div class="order-line__point--line"></div>
    </div>

    <div class="order-line__point" data-index="1">
        <div class="order-line__point--label">Dane do wysyłki i faktury</div>
        <svg class="order-line__point__bullet">
            <circle class="order-line__point__bullet--circle"></circle>
        </svg>
        <img class="order-line__point--image" src="white-check-mark-md.png">

        <div class="order-line__point--line"></div>
    </div>

    <div class="order-line__point" data-index="2">
        <div class="order-line__point--label">Płatność i dostawa</div>
        <svg class="order-line__point__bullet">
            <circle class="order-line__point__bullet--circle"></circle>
        </svg>
        <img class="order-line__point--image" src="white-check-mark-md.png">

        <div class="order-line__point--line"></div>
    </div>

    <div class="order-line__point" data-index="3">
        <div class="order-line__point--label">Finalizacja</div>
        <svg class="order-line__point__bullet">
            <circle class="order-line__point__bullet--circle"></circle>
        </svg>
        <img class="order-line__point--image" src="white-check-mark-md.png">

    </div>
</section>

<script>

    class OrderProcess {
        constructor(options) {
            let defaults = {
                isClickableForward: false,
                isClickableBackward: true,
                reIndexAfterRemove: true,
                sectionWidth: null,
                onClick: function (index) {}
            };
            this.options = Object.assign(defaults, options);
            this.currentIndex = 0;

            if (this.options.sectionWidth !== null) {
                document.getElementById("order-process").style.cssText = "--order-line-point-width: " + this.options.sectionWidth + "px";
            }

            this.bulletPoints = document.querySelectorAll("#order-process .order-line__point");
            this.initListners();
        }

        initListners() {
            this.bulletPoints.forEach((element) => {
                element.addEventListener("click", () => {
                    let index = element.getAttribute('data-index');

                    if ((index > this.currentIndex && this.options.isClickableForward !== false) || (index < this.currentIndex && this.options.isClickableBackward === true)) {
                        this.moveTo(index);

                        this.options.onClick(index);
                        this.currentIndex = index;
                    }
                });
            });
        }

        next() {
            if (this.bulletPoints[this.currentIndex + 1]) {
                this.bulletPoints[this.currentIndex].classList.remove("current-bullet");
                this.bulletPoints[++this.currentIndex].classList.add("current-bullet", "active-bullet");
            }

            return this;
        }

        previous() {
            if (this.bulletPoints[this.currentIndex - 1]) {
                this.bulletPoints[this.currentIndex].classList.remove("current-bullet", "active-bullet");
                this.bulletPoints[--this.currentIndex].classList.add("current-bullet");
            }

            return this;
        }

        moveTo(position) {
            this.bulletPoints.forEach((el) => {
                let index = el.getAttribute('data-index');
                if (index <= position) {
                    el.classList.add("active-bullet");

                } else {
                    el.classList.remove("active-bullet");
                }
            });

            this.bulletPoints[this.currentIndex].classList.remove("current-bullet");
            this.bulletPoints[position].classList.add("current-bullet");
        }

        removeElement(index) {
            if (this.bulletPoints[index]) {
                this.bulletPoints[index].remove();
            }

            this.bulletPoints = Array.prototype.slice.call(this.bulletPoints).filter(function (element, id) {
                if (index === id) {
                    return false;
                }

                return true;
            });

            document.getElementById("order-process").style.cssText = "--order-process-sections: " + this.bulletPoints.length;

            if (this.options.reIndexAfterRemove === true) {
                this.reIndex();
            }
        }

        reIndex() {
            let i = 0;

            this.bulletPoints.forEach(function (element) {
                element.setAttribute("data-index", i++);
            })
        }
    }


/*
    Options / Callback
      isClickableForward: false,
      isClickableBackward: true,
      reIndexAfterRemove: true,
      sectionWidth: 220,
      onClick: function (index) {}
    API:
      next()
      previous()
      moveTo(index)
      removeElement()
 */

const a = new OrderProcess({
    isClickableForward: true
});

</script>

